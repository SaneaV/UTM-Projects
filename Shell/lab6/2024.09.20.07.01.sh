# Процесс «Генератор» считывает с консоли строки в бесконечном цикле. Если считанная строка содержит единственный символ «+», он посылает процессу «Обработчик» сигнал USR1. Если строка содержит единственный символ «*», генератор посылает обработчику сигнал USR2. Если строка содержит слово TERM, генератор посылает обработчику сигнал SIGTERM. Другие значения входных строк игнорируются. Обработчик добавляет 2 или умножает на 2 текущее значение обрабатываемого числа (начальное значение принять на единицу) в зависимости от полученного пользовательского сигнала и выводит результат на экран. Вычисление и вывод производятся один раз в секунду. Получив сигнал SIGTERM, «Обработчик» завершает свою работу, выведя сообщения о завершении работы по сигналу от другого процесса.

#!/bin/bash

# Начальное значение переменной
value=1  # Переменная, которую будем изменять в зависимости от сигналов
operation=1

# Функция для обработки сигнала USR1
# При получении этого сигнала значение переменной увеличивается на 2
add_handler() {
  operation=1
  value=$((value + 2))  # Увеличение значения на 2
  echo "Сигнал USR1 получен. Новое значение: $value"  # Сообщение о новом значении
}

# Функция для обработки сигнала USR2
# При получении этого сигнала значение переменной умножается на 2
multiply_handler() {
  operation=2
  value=$((value * 2))  # Умножение значения на 2
  echo "Сигнал USR2 получен. Новое значение: $value"  # Сообщение о новом значении
}

# Функция для обработки сигнала SIGTERM
# Эта функция завершает работу обработчика
terminate_handler() {
  echo "Обработчик завершает работу по сигналу SIGTERM."  # Сообщение о завершении
  exit 0  # Выход из скрипта
}

# Перехват сигналов и назначение обработчиков
trap 'add_handler' USR1  # Перехват сигнала USR1 и вызов add_handler
trap 'multiply_handler' USR2  # Перехват сигнала USR2 и вызов multiply_handler
trap 'terminate_handler' SIGTERM  # Перехват сигнала SIGTERM и вызов terminate_handler

# Бесконечный цикл вывода текущего значения переменной
while true
do
  if [ $operation == 1 ]; then
  value=$((value + 2))
  else
  value=$((value *2))
  fi
  echo "Текущее значение: $value"  # Вывод текущего значения
  sleep 1  # Пауза на 1 секунду перед следующим выводом
done
